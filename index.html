<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åƒç´ å¯¹æˆ˜å°æ¸¸æˆ</title>
    <style>
        body { font-family: monospace; background: #222; color: #eee; text-align: center; }
        button { margin: 5px; padding: 10px; font-size: 20px; }
        #log { margin-top: 20px; white-space: pre-wrap; }
        #playerInfo { margin-top: 20px; font-size: 18px; }
        #playerInfo div { margin: 5px; }
    </style>
</head>
<body>

    <h1>ğŸ½ï¸ ä½ åƒæˆ‘åƒ ğŸ½ï¸</h1>

    <div id="buttons">
        <button onclick="sendMove('æˆ‘')">å‡º æˆ‘</button>
        <button onclick="sendMove('ä½ ')">å‡º ä½ </button>
        <button onclick="sendMove('ğŸ’©')">å‡º å±</button>
        <button onclick="sendMove('ğŸ”')">å‡º æ±‰å ¡</button>
    </div>

    <div id="playerInfo">
        <div id="yourName">ä½ çš„åå­—ï¼š-</div>
        <div id="enemyName">å¯¹æ‰‹åå­—ï¼š-</div>
    </div>    

    <div id="log"></div>

    <script>
        let playerName = '';
        let ws = new WebSocket('wss://ueatmeeat-production.up.railway.app'); // è®°å¾—æ¢æˆä½ æœåŠ¡å™¨åœ°å€ï¼

        window.onload = () => {
            playerName = prompt('è¯·è¾“å…¥ä½ çš„åå­—ï¼š');
            if (!playerName) {
                playerName = 'ç©å®¶' + Math.floor(Math.random() * 1000); // å¦‚æœæ²¡å¡«åå­—ï¼Œç»™ä¸ªé»˜è®¤
            }

            startGame();
        };

        function startGame() {
            log(`ğŸ‘‹ æ¬¢è¿ ${playerName}ï¼`);
            log('âš”ï¸ å‡†å¤‡å¼€å§‹å¯¹æˆ˜ï¼');

            ws.onopen = () => {
                log('âœ… è¿æ¥æˆåŠŸï¼å‡†å¤‡å‡ºæ‹›ï½');
                document.getElementById('yourName').textContent = `ä½ çš„åå­—ï¼š${playerName}`;
                ws.send(JSON.stringify({ type: 'setName', name: playerName }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);

                // æ›´æ–°ç©å®¶å’Œå¯¹æ‰‹åå­—
                document.getElementById('yourName').textContent = `ä½ çš„åå­—ï¼š${data.yourName}`;
                document.getElementById('enemyName').textContent = `å¯¹æ‰‹åå­—ï¼š${data.enemyName}`;

                log(`ç©å®¶${data.yourName}å‡ºæ‹›ï¼š${data.yourMove} ç©å®¶${data.enemyName}å‡ºæ‹›ï¼š${data.enemyMove}`);
                log(`â¤ï¸ å½“å‰è¡€é‡\nç©å®¶1: ${data.yourHP}\nç©å®¶2: ${data.enemyHP}`);

                if (data.winner) {
                    log(`ğŸ† èƒœåˆ©è€…ï¼š${data.winner}`);
                }
                if (data.loser) {
                    log(`ğŸ’€ è¾“äº†ï¼š${data.loser}`);
                }

                if (data.winner || data.loser) {
                // æ¸¸æˆç»“æŸäº†ï¼Œä¸è§£é”æŒ‰é’®
                    return;
                }

                // å¦‚æœæ¸¸æˆæ²¡ç»“æŸï¼Œé‡æ–°å¯ç”¨æŒ‰é’®
                const buttons = document.querySelectorAll('#buttons button');
                buttons.forEach(btn => btn.disabled = false);

            };

            ws.onclose = () => {
                log('âŒ è¿æ¥æ–­å¼€äº†');
            };

        }
        

        function sendMove(action) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ è¿æ¥æœªæ‰“å¼€ï¼Œæ— æ³•å‘é€å‡ºæ‹›ï¼');
                return;
            } else {
                // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
                const buttons = document.querySelectorAll('#buttons button');
                buttons.forEach(btn => btn.disabled = true);

                ws.send(JSON.stringify({ action: action }));
                log(`ğŸ¯ ä½ å‡ºäº†ï¼š${action}`);
            }
        }

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>

</body>
</html>
